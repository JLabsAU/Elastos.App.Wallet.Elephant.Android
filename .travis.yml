language: android
sudo: required
android:
  components:
  - build-tools-28.0.3
  - android-28
  - extra-android-m2repository
  - extra-android-support
licenses:
- android-sdk-preview-license-.+
- android-sdk-license-.+
- google-gdk-license-.+
before_install:
- openssl aes-256-cbc -K $encrypted_57d286c34edd_key -iv $encrypted_57d286c34edd_iv
  -in elastos.jks.enc -out elastos.jks -d
- echo "y" | sdkmanager "cmake;3.6.4111459"
- chmod +x gradlew
- "./gradlew dependencies || true"
script:
- "./gradlew assembleRelease"
before_script:
- wget https://dl.google.com/android/repository/android-ndk-r16b-linux-x86_64.zip
- unzip -qq android-ndk-r16b-linux-x86_64.zip
- export ANDROID_NDK_HOME=`pwd`/android-ndk-r16b
- export LOCAL_ANDROID_NDK_HOME="$ANDROID_NDK_HOME"
- export LOCAL_ANDROID_NDK_HOST_PLATFORM="linux-x86_64"
- export PATH=$PATH:${ANDROID_NDK_HOME}
- env
before_deploy:
- ls
deploy:
  provider: releases
  api_key:
    secure: oC8TT19HJbQPH8vM4iY4HPQfJ2xhTlpn7OWS56mcojTxZozN70oIhtIhFqo1xUMfcStdD4yJdY7fpqxCDJMd/c5Ue9sWexjv1HYt7i7ffE7K+hzWO9hyG4GgN/RMimAS+EXPii/ZvoKy9OP4WkhGZ2trV3A5EJNuuV++i/brG2MuEw2P6SpNgFBvgiCi13Wv34wpyre3C3XuxrQof7lPePGfkZVjQenj11wpcmpRTyW0QNwr+TGq1plcE68Ual6UqeJisVJbbFoXvgM7h85DeX6Pra6rGhQ0kcwcf9IxEhBY3UVSYAdFMF6YixhS2moitAv1wF5TDsnQb6Ttc3SCQHtUQ/JsnIowhvSESCg5Yl6pHawerPkOhz0+Rh+1x7JvmDnAa6Umyy82bNhFo9qtwnrR+W3U2ejHRVzlq1J/+289Yi3+eSUz2yK6JBL0gkgCKfvjcH6fW1jvJvn+5uFyPNB+dylCx0Qq4CGucBj+O9aPuiBx4l7crxxL1FHZMeZKjDOQMb7Mb5oWmtWQwtjksNLVxm6CJM3h9/g77TtdOcNqXRatFwT/qC6PJICBtIhsBcj2BLKbkGNnOfHKbbwuZlTw9gGBMm+XlpqvuQWwAHuARtMWVKMKYpCruJe+wCF2nq3MkOWywI2fz2Xn8rUvWYwyVN4z6yyu5Gf9MjKoHLc=
  file: elephant_wallet_test.apk
  skip_cleanup: true
  on:
    repo: xidaokun/Elastos.App.Wallet.Elephant.Android
    branch: release_v1.3
    tags: true
notifications:
  email:
  - 15921908346@163.com
before_cache:
- rm -f $HOME/.gradle/caches/modules-2/modules-2.lock
cache:
  directories:
  - "$HOME/.m2"
  - "$HOME/.gradle"
  - "$HOME/.gradle/caches/"
  - "$HOME/.gradle/wrapper/"
env:
  global:
  - secure: qNCAkKrKBzqqaEkPeP4ibIxVJFGzu8jQt9MPzXbtdICB/ZDG1AO/5At9FlMFoBVwVyVsJimAb2fD5AcrZ+O2EJyxe6RYU5oIAl58ahGVNBcgmuk1WJToR7CJ0///8iB9+Wu4cE/wqQJLEnbQMV9Qma97fqa0BPmw0XfqdpPDS7kKhxQ49Bc4FY+su/HBz8exXyNV52J1gsz6WfNqhVxVlTfljkcJws59eGps8JrptC0o2B4DX5X5AqV6ctf3/qw4hXgFkvZTUHfGRfEECt1oHjniEdLhMp83bVNHPiZKn9EJ808o3GCnzWtfzN73QL9nRjHeiLCmQG0IFZm9nZTJGVObmMBupFm/VzEKeh8SnJxjucZ0/EZHpVsKQbdxOhpTVzA5KgJ/SIHFnDQQ7KcQaIVgabVe8n/099b4UOapVgCMP8D3OokBLyS2Kn6+iNoHgSaodrXuy9/otei2qTCd+Ki1luvjMBxjRDh0ve3NZvbFzEZrcgieFskqbu4TE30aHWfTJvOffZsBTrc7WZOA5+StDqU0OQxBweYkR8wzm/C89xSTBKP121wPK1RrIoRcBqtwmz0vOxX9hgcAWprmpBW6DBXlDRfI57I5llx7/QmW/y4xdHQhiKHrtZ+buImOndmwVsZdDNl4XL1baYzJVaAw7HrooLUNeWEDy0fc1jA=
  - secure: QEZStob86hH2u9lvKjf/vhak+i4W2IdmqDsN42jpCqz8CE1w83zYlYJRtvNoA2gw6OGuYm3DBNIp1J0ig8SxvAJqpl2v+Qge/rW74Z20fnSXQC80eqG+rNVmBObFNn9cTaNusBBUcGF20TyjSD4fXV5dMARIPFOcqcWsC3BoXM5RSgdomByzRGq2D1TUSp8BuW8Ar5iPpuPR++XP4jXtjnu32RUxSFy9rNX0kjN5POXWr+XFgvw4SHyVAWi4GqnViCdSDGBYpKwYWeD2oSssPhGw0AVeBlnpbc7IolkKAbfINFji3zMa/BFHAB0+gKwKahpmP8xMBr8GbWG5lTR/YcKqkS7T9K1KhAi0x3ZrqlOUflh7dUHdeHCRJG5pBHDmR9gp8FnAxv14apm4A0/qY2evVB3h/aGTbNaKd/lvx4P7UObo68sC9K36XkO6y2VqbBGhXsK75ENlaSCJMuSdOVJGf2CbyVcKAnNu3VtLJjmtBwPYWGXmv1I+xCidAjttGBGNgM0rQ3nkGMZZND9LSXK1LK9kFC5lKFI29Czt3gmTEn/pro4t/ASfBubnRcwtq6eqM61lNI0cH4TSEmmgWuKxACCnMjz0LJKolwLpFD5XUVUX2d5aq8MsJkt8IlJUkGk9YpLlNgAtHEw8ZY3BIyFX2AatQRtubPu4lDuOJ74=
after_success:
- cp $TRAVIS_BUILD_DIR/elastos.jks $HOME
- cd app/build/outputs/apk/ela/release/
- jarsigner -verbose -sigalg SHA1withRSA -digestalg SHA1 -keystore $HOME/elastos.jks
  -storepass $storepass -keypass $keypass app-ela-release-unsigned.apk elastos
- jarsigner -verify app-ela-release-unsigned.apk
- "${ANDROID_HOME}/build-tools/28.0.3/zipalign -v 4 app-ela-release-unsigned.apk elephant_wallet_test.apk"